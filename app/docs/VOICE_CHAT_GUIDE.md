# 语音对话功能使用指南

## 功能概述

本应用已成功集成语音对话功能，支持以下特性：

1. **语音输入**：通过手机麦克风录制用户语音
2. **语音转文本**：使用系统内置语音识别API将语音转换为文本
3. **AI对话**：集成豆包大模型API，提供智能对话服务
4. **文本转语音**：将AI回复转换为语音播放
5. **对话历史**：本地存储对话记录，支持多轮对话

## 使用方法

### 1. 启动语音对话
- 打开应用，点击底部导航栏的"Voice"标签
- 进入语音助手界面

### 2. 开始对话
- 点击大圆形麦克风按钮开始录音
- 对着手机说话，系统会自动识别语音
- 说完后点击停止按钮或等待自动停止
- 系统将自动处理语音并返回AI回复

### 3. 功能按钮
- **麦克风按钮**：点击开始/停止语音录制
- **清除按钮**：清除所有对话历史记录
- **关闭按钮**：退出语音对话界面

## 配置说明

### API配置
1. 复制`.env.example`文件为`.env`
2. 在`.env`文件中配置豆包API密钥：
   ```
   EXPO_PUBLIC_DOUBAO_API_KEY=your_actual_api_key_here
   ```

### 权限设置
应用已自动配置以下权限：
- `android.permission.RECORD_AUDIO`：录音权限
- `android.permission.INTERNET`：网络访问权限
- `android.permission.ACCESS_NETWORK_STATE`：网络状态权限

## 技术架构

### 核心组件
- **VoiceService**：语音服务核心类，处理录音、识别、API调用等
- **VoiceChat**：语音对话UI组件
- **API配置**：统一的API配置管理

### 数据流程
1. 用户点击麦克风按钮
2. 开始语音识别
3. 语音转文本
4. 调用豆包API获取回复
5. 文本转语音播放
6. 保存对话历史到本地存储

### 存储机制
- 使用AsyncStorage本地存储对话历史
- 支持对话记录的增删查改操作
- 自动维护对话时间戳

## 注意事项

1. **网络连接**：需要稳定的网络连接以调用豆包API
2. **麦克风权限**：首次使用需要授予麦克风权限
3. **API密钥**：需要有效的豆包API密钥才能正常使用AI对话功能
4. **语音识别**：支持中文语音识别，识别准确率依赖于设备和环境
5. **语音播放**：使用系统TTS服务，支持中文语音合成

## 故障排除

### 常见问题
1. **无法录音**：检查麦克风权限设置
2. **AI无回复**：检查网络连接和API密钥配置
3. **语音识别失败**：确保环境安静，说话清晰
4. **语音播放异常**：检查设备音量设置

### 错误处理
- 所有异常都有相应的错误提示
- 网络错误会显示友好的提示信息
- 录音失败会自动重置状态

## 扩展功能

可以进一步扩展的功能：
1. 支持多语言语音识别
2. 自定义AI助手人格
3. 语音情感识别
4. 对话导出功能
5. 语音指令快捷操作